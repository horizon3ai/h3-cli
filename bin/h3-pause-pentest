#!/bin/bash
#
# Simple shell script for pausing a pentest.
#

# 0.
# include common utils
source h3-env


# 1.
# read pentest either from args or from latest-pentest
pentest=`h3 pentest $*`
rc=$?
if [ $rc -ne 0 ]; then
    echo $pentest
    exit $rc
fi


# 2.
# if the pentest is running, pause it.
pentest_name=`cat <<<$pentest | jq -r .name`
pentest_state=`cat <<<$pentest | jq -r .state`
op_id=`cat <<<$pentest | jq -r .op_id`
if [ "$pentest_state" = "running" ]; then
    res=`h3-gql pause_op $op_id`
    rc=$?
    if [ $rc -eq 0 ]; then
        echoerr "Pausing pentest \"$pentest_name\" with op_id $op_id. It may take a few seconds before the pentest fully pauses."
    else
        echo $res
        exit $rc
    fi
else
    echoerr "Pentest \"$pentest_name\" with op_id $op_id is not in \"running\" state ($pentest_state)."
fi


