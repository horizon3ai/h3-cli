#!/bin/bash
#
# Read pentests configurations from a file and run them all consecutively.
#
 
source h3-env

# 1.
# read and validate input
input_file=$1
sleep_s=180

if [ -z "$input_file" ]; then
    echoerr "input_file is required"
    exit 1
fi

# 2.
# loop thru input file, kicking off pentests (consecutively) for each line
cat $input_file | grep -v '^#' | while read line || [[ -n $line ]]; do
    while true; do
        echoerr "Starting pentest for $line" 
        h3-run-pentest "$line"
        if [ $? -eq 0 ]; then
            break
        fi
        echoerr "Retrying in $sleep_s seconds ..."
        sleep $sleep_s
    done
done
 

echoerr "All pentests have been started."